var F="standard",$="easy",Y=!1,D=document.querySelectorAll(".mode-tab"),U=document.getElementById("panelPrimaryTitle"),A=document.getElementById("panelPrimarySubtitle"),V=document.getElementById("previewText"),L=document.querySelectorAll(".difficulty-chip"),v=document.querySelectorAll(".tag-chip"),b=document.querySelectorAll(".setting-pill"),H=document.getElementById("customGamemode"),G=document.getElementById("customTimer"),w=document.getElementById("customRounds"),B=document.getElementById("customHealth"),Z=document.getElementById("customPanel"),z=document.getElementById("standardPanel"),N=document.getElementById("startBtn"),E=document.getElementById("allToggle"),M=document.getElementById("tags-list");function x(){if(D.forEach((j)=>{j.classList.toggle("active",j.dataset.mode===F)}),F==="standard")U.textContent="Standard mode",A.textContent="5 rounds | Get the highest score",Z.hidden=!0,z.hidden=!1;else if(F==="endless")U.textContent="Endless mode",A.textContent="Health-based run | Survive as long as you can",Z.hidden=!0,z.hidden=!1;else if(F==="custom")z.hidden=!0,Z.hidden=!1;I()}function I(){if(F!=="custom"){N.disabled=!1,W();return}let j=H.value,k=document.getElementById("numRounds"),q=document.getElementById("startHealth");if(j==="standard")q.style.display="none",k.style.display="flex";else if(j==="endless")k.style.display="none",q.style.display="flex";N.disabled=X("difficulty").length>0,W()}function W(){let j=[];if(F==="standard")j.push("Mode: Standard"),j.push(`Difficulty: ${_($)}`);else if(F==="endless")j.push("Mode: Endless"),j.push(`Difficulty: ${_($)}`);else if(F==="custom"){j.push("Mode: Custom");let q=X("difficulty"),J=X("location"),K=H.value,Q=5,O=5000;N.disabled=!Boolean(q.length);try{Q=Number(w.value)}catch(C){}try{O=Number(B.value)}catch(C){}let R=Number(G.value||0);j.push("Difficulties: "+(q.length?q.join(", "):"none")),j.push("Tags: "+(Y?"All":J.length?J.join(", "):"none")),j.push(`Gamemode: ${_(K)}`),j.push(`${K==="standard"?`Rounds: ${Math.max(1,Q)}`:`Health: ${Math.max(1,O)}`}`),j.push(`Timer: ${R>0?R+"s":"no limit"}`)}let k=j.map((q,J)=>{if(J===0){let[K,Q]=q.split(": ");if(!Q)return q;return`${K}: <strong>${Q}</strong>`}return q}).join(" | ");return V.innerHTML=k,k}function _(j){if(!j)return"";return j.charAt(0).toUpperCase()+j.slice(1)}function X(j,k=!0){return Array.from(Z.querySelectorAll(`.tag-chip[data-tag-type="${j}"].selected`)).map((q)=>k?_(q.dataset.tag):q.dataset.tag)}D.forEach((j)=>{j.addEventListener("click",()=>{let k=j.dataset.mode;if(!k||j.disabled)return;F=k,x()})});L.forEach((j)=>{j.addEventListener("click",()=>{if(F==="custom")return;$=j.dataset.tag,L.forEach((k)=>k.classList.toggle("selected",k===j)),W()})});if(L.length)L[0].classList.add("selected");v.forEach((j)=>{j.addEventListener("click",()=>{if(j.classList.toggle("selected"),F==="custom")W()})});b.forEach((j)=>{j.addEventListener("change",()=>{if(F==="custom")I()})});E.addEventListener("click",()=>{let j=Array.from(M.children);if(Y){Y=!1,E.classList.remove("selected");for(let k of j)if(k.classList.contains("tag-chip"))k.classList.remove("selected","disabled")}else{Y=!0,E.classList.add("selected");for(let k of j)if(k.classList.contains("tag-chip")&&!k.classList.contains("all"))k.classList.add("selected","disabled")}W()});function y(){if(F==="standard"||F==="endless")return{gamemode:F,difficulty:$||null};let j=X("difficulty",!1),k=X("location",!1),q=5,J=5000;try{q=Number(w.value)}catch(K){}try{J=Number(B.value)}catch(K){}return{gamemode:H.value,gamemodeParam:H.value==="standard"?Math.max(1,q):Math.max(1,J),timerSeconds:Number.parseInt(G.value||"0"),difficulties:j,tags:k}}N.addEventListener("click",async()=>{let j=y();console.log("Starting game with:",j);let k=await fetch("./api/getsession",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}),{sessionid:q}=await k.json();if(sessionStorage.setItem("sessionid",q.toString()),!j.gamemodeParam)j.gamemodeParam=j.gamemode==="standard"?5:5000;if(!j.timerSeconds&&j.timerSeconds!==0)j.timerSeconds=60;sessionStorage.setItem("gameState",JSON.stringify(j)),window.location.href="./game"});x();
