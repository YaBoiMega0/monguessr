var F="standard",_="easy",X=!1,D=document.querySelectorAll(".mode-tab"),U=document.getElementById("panelPrimaryTitle"),A=document.getElementById("panelPrimarySubtitle"),V=document.getElementById("previewText"),$=document.querySelectorAll(".difficulty-chip"),v=document.querySelectorAll(".tag-chip"),b=document.querySelectorAll(".setting-pill"),L=document.getElementById("customGamemode"),G=document.getElementById("customTimer"),w=document.getElementById("customRounds"),B=document.getElementById("customHealth"),Y=document.getElementById("customPanel"),N=document.getElementById("standardPanel"),E=document.getElementById("startBtn"),z=document.getElementById("allToggle"),M=document.getElementById("tags-list");function x(){if(D.forEach((j)=>{j.classList.toggle("active",j.dataset.mode===F)}),F==="standard")U.textContent="Standard mode",A.textContent="5 rounds | Get the highest score",Y.hidden=!0,N.hidden=!1;else if(F==="endless")U.textContent="Endless mode",A.textContent="Health-based run | Survive as long as you can",Y.hidden=!0,N.hidden=!1;else if(F==="custom")N.hidden=!0,Y.hidden=!1;I()}function I(){if(F!=="custom"){E.disabled=!1,W();return}let j=L.value,k=document.getElementById("numRounds"),q=document.getElementById("startHealth");if(j==="standard")q.style.display="none",k.style.display="flex";else if(j==="endless")k.style.display="none",q.style.display="flex";W()}function W(){let j=[];if(F==="standard")j.push("Mode: Standard"),j.push(`Difficulty: ${Z(_)}`);else if(F==="endless")j.push("Mode: Endless"),j.push(`Difficulty: ${Z(_)}`);else if(F==="custom"){j.push("Mode: Custom");let q=H("difficulty"),J=H("location"),K=L.value,Q=5,O=5000;E.disabled=!Boolean(q.length);try{Q=Number(w.value)}catch(C){}try{O=Number(B.value)}catch(C){}let R=Number(G.value||0);j.push("Difficulties: "+(q.length?q.join(", "):"none")),j.push("Tags: "+(X?"All":J.length?J.join(", "):"none")),j.push(`Gamemode: ${Z(K)}`),j.push(`${K==="standard"?`Rounds: ${Math.max(1,Q)}`:`Health: ${Math.max(1,O)}`}`),j.push(`Timer: ${R>0?R+"s":"no limit"}`)}let k=j.map((q,J)=>{if(J===0){let[K,Q]=q.split(": ");if(!Q)return q;return`${K}: <strong>${Q}</strong>`}return q}).join(" | ");return V.innerHTML=k,k}function Z(j){if(!j)return"";return j.charAt(0).toUpperCase()+j.slice(1)}function H(j,k=!0){return Array.from(Y.querySelectorAll(`.tag-chip[data-tag-type="${j}"].selected`)).map((q)=>k?Z(q.dataset.tag):q.dataset.tag)}D.forEach((j)=>{j.addEventListener("click",()=>{let k=j.dataset.mode;if(!k||j.disabled)return;F=k,x()})});$.forEach((j)=>{j.addEventListener("click",()=>{if(F==="custom")return;_=j.dataset.tag,$.forEach((k)=>k.classList.toggle("selected",k===j)),W()})});if($.length)$[0].classList.add("selected");v.forEach((j)=>{j.addEventListener("click",()=>{if(j.classList.toggle("selected"),F==="custom")W()})});b.forEach((j)=>{j.addEventListener("change",()=>{if(F==="custom")I()})});z.addEventListener("click",()=>{let j=Array.from(M.children);if(X){X=!1,z.classList.remove("selected");for(let k of j)if(k.classList.contains("tag-chip"))k.classList.remove("selected","disabled")}else{X=!0,z.classList.add("selected");for(let k of j)if(k.classList.contains("tag-chip")&&!k.classList.contains("all"))k.classList.add("selected","disabled")}W()});function y(){if(F==="standard"||F==="endless")return{gamemode:F,difficulty:_||null};let j=H("difficulty",!1),k=H("location",!1),q=5,J=5000;try{q=Number(w.value)}catch(K){}try{J=Number(B.value)}catch(K){}return{gamemode:L.value,gamemodeParam:L.value==="standard"?Math.max(1,q):Math.max(1,J),timerSeconds:Number.parseInt(G.value||"0"),difficulties:j,tags:k}}E.addEventListener("click",async()=>{let j=y();console.log("Starting game with:",j);let k=await fetch("./api/getsession",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)}),{sessionid:q}=await k.json();if(sessionStorage.setItem("sessionid",q.toString()),!j.gamemodeParam)j.gamemodeParam=j.gamemode==="standard"?5:5000;if(!j.timerSeconds&&j.timerSeconds!==0)j.timerSeconds=60;sessionStorage.setItem("gameState",JSON.stringify(j)),window.location.href="./game"});x();
